

هذا بوت تيليجرام مصمم لتحميل الصور والفيديوهات من روابط منصة X (تويتر سابقًا) التي يرسلها المستخدمون. يتميز البوت بقدرته على معالجة روابط متعددة في رسالة واحدة، وإرسال الصور في ألبومات، والتعامل مع الفيديوهات كبيرة الحجم عبر إرسالها إلى قناة مخصصة.

## الميزات

- **دعم روابط متعددة**: استخراج ومعالجة جميع روابط `x.com`, `twitter.com`, `t.co` في رسالة واحدة.
- **تنزيل ذكي للفيديو**: يستخدم `yt-dlp` كأولوية أولى للحصول على أفضل جودة للفيديو، ويدعم التغريدات المحمية عبر ملف `cookies`.
- **واجهة API احتياطية**: في حال فشل `yt-dlp` أو عدم وجود فيديو، يعود لاستخدام `vxtwitter` API.
- **إرسال الصور كألبومات**: يتم تجميع الصور وإرسالها في مجموعات (MediaGroup) تصل إلى 5 صور لكل مجموعة.
- **معالجة الملفات الكبيرة**:
  - الفيديوهات الأقل من أو تساوي 50MB تُرسل مباشرة للمستخدم.
  - الفيديوهات الأكبر من 50MB تُرفع تلقائيًا إلى قناة محددة باستخدام `Pyrogram`.
- **معالجة غير متزامنة (Async)**: مكتوب بالكامل بأسلوب `async/await` لتحقيق أداء عالٍ واستجابة سريعة.
- **طابور انتظار لكل محادثة**: يمنع التداخل بين الطلبات ويضمن معالجة الرسائل بالترتيب لكل مستخدم على حدة.
- **تنظيف تلقائي**: حذف الملفات المؤقتة بعد الانتهاء من إرسالها.

## المتطلبات التقنية

- Python 3.10+
- `ffmpeg` (يجب تثبيته على النظام ليعمل `yt-dlp` بشكل صحيح).
  - على أنظمة Debian/Ubuntu: `sudo apt update && sudo apt install ffmpeg`
  - على أنظمة macOS (باستخدام Homebrew): `brew install ffmpeg`

## خطوات الإعداد

### 1. استنساخ المستودع

```bash
git clone <repository_url>
cd project
```

### 2. تثبيت المكتبات

أنشئ بيئة افتراضية (مستحسن) وقم بتثبيت المتطلبات.

```bash
python3 -m venv venv
source venv/bin/activate  # على Windows استخدم `venv\Scripts\activate`
pip install -r requirements.txt
```

### 3. إعداد متغيرات البيئة

1.  انسخ ملف `.env.example` إلى `.env`.
    ```bash
    cp .env.example .env
    ```
2.  افتح ملف `.env` واملأ المتغيرات المطلوبة:
    - `BOT_TOKEN`: توكن البوت الخاص بك من [@BotFather](https://t.me/BotFather).
    - `ID` و `HASH`: احصل عليهما من [my.telegram.org](https://my.telegram.org).
    - `PYRO_SESSION_STRING`: جلسة Pyrogram. يمكنك إنشاؤها عبر تشغيل سكربت بسيط (مثل [هذا السكربت](https://docs.pyrogram.org/faq/what-is-a-session-string)).
    - `CHANNEL_IDtwiter`: معرّف القناة (يجب أن يبدأ بـ `-100`) التي سيتم إرسال الملفات الكبيرة إليها. تأكد من أن حساب المستخدم (الخاص بـ `PYRO_SESSION_STRING`) لديه صلاحية النشر في هذه القناة وأن البوت أيضًا مشرف فيها.
    - `OUTPUT_DIR`: (اختياري) المسار لتخزين الملفات المؤقتة. الإعداد الافتراضي هو `/tmp/x_bot_downloads`.
    - `X_COOKIES`: (اختياري) مسار ملف `cookies.txt` لاستخدامه مع التغريدات المحمية. يمكنك تصديره من متصفحك باستخدام إضافة مثل "Get cookies.txt".

### 4. تشغيل البوت

بمجرد إعداد كل شيء، قم بتشغيل البوت:

```bash
python main.py
```

الآن، أرسل أي رابط من منصة X إلى البوت في الدردشة الخاصة أو في مجموعة، وسيقوم بمعالجته.
```
